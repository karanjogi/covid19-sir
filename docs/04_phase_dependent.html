<!-- Refer to https://stackoverflow.com/a/50495306 -->

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phase-dependent SIR models &mdash; CovsirPhy  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/lisphilar/covid19-sir/master/docs/logo/covsirphy_favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Scenario analysis" href="05_scenario_analysis.html" />
    <link rel="prev" title="SIR-derived ODE models" href="03_ode.html" />
<script type="text/javascript">
    window.onload = function () {
        string = document.body.innerHTML;
        string = string.replace(/ package/g, '').replace(/ module/g, '');
        document.body.innerHTML = string;
    }
</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="https://raw.githubusercontent.com/lisphilar/covid19-sir/master/docs/logo/covsirphy_logo_100.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0.0.dev15
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="README.html">CovsirPhy introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown/INSTALLATION.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_data_preparation.html">Data preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_data_engineering.html">Data engineering</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_ode.html">SIR-derived ODE models</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Phase-dependent SIR models</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#1.-Dynamics-of-phase-dependent-SIR-models">1. Dynamics of phase-dependent SIR models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1-1.-Define-the-0th-phase">1-1. Define the 0th phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-2.-Define-the-1st-phase">1-2. Define the 1st phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-3.-Track-ODE-parameter-values">1-3. Track ODE parameter values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-4.-Simulation">1-4. Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#1-5.-Observable-variables">1-5. Observable variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-S-R-change-point-analysis">2. S-R change point analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#2-1.-S-R-plane">2-1. S-R plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2-2.-log(S)-vs.-R-plane">2-2. log(S) vs. R plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2-3.-Plane-of-phase-dependent-models">2-3. Plane of phase-dependent models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.4-Time-series-segmentation">2.4 Time-series segmentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.-ODE-parameter-estimation">3. ODE parameter estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#3.1-Preparation">3.1 Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.2-Tau-estimation">3.2 Tau estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.3-ODE-parameter-estimation">3.3 ODE parameter estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#4.-With-actual-data">4. With actual data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#4-1.-Data-preparation">4-1. Data preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-2.-Time-series-segmentation">4-2. Time-series segmentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-3.-Parameter-estimation">4-3. Parameter estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-4.-Accuracy-evaluation">4-4. Accuracy evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-5.-Simulation">4-5. Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4-6.-Tracking-of-ODE-parameters">4-6. Tracking of ODE parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="05_scenario_analysis.html">Scenario analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_prediction.html">ODE parameter prediction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="covsirphy.html">covsirphy package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">General</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="markdown/TERM.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="CODE_OF_CONDUCT.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="SECURITY.html">Security policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contribution guideline</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CovsirPhy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Phase-dependent SIR models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><a class="reference external" href="https://mybinder.org/v2/gh/lisphilar/covid19-sir/HEAD?labpath=example%2F04_phase_dependent.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
<div class="section" id="Phase-dependent-SIR-models">
<h1>Phase-dependent SIR models<a class="headerlink" href="#Phase-dependent-SIR-models" title="Permalink to this heading"></a></h1>
<p>SIR-derived ODE models (SIR, SIR-D, SIR-F) assume that ODE parameter values are always constant. Can we apply this assumption to real data?</p>
<p><a class="reference external" href="https://www.kaggle.com/code/lisphilar/covid-19-data-with-sir-model/notebook">Kaggle: COVID-19 data with SIR model</a> concluded this was No - ODE parameter values change with phases - because measures taken by people changed the situation of COVID-19 outbreak actually. Term “phase” means a sequential dates in which the parameters of SIR-derived models are constant. To remove fluctuations from analysis, “time-dependent” should be avoided.</p>
<hr class="docutils" />
<p>The first section will show the dynamics of phase-dependent SIR models with sample data.</p>
<p>The Kaggle notebook also suggested detailed steps of applying phase-dependent SIR models to actual data. The second section demonstrates how to divide actual time-series data to phases (time-series segmentation with “S-R change point analysis”). The third section is to estimate ODE parameter values of phases (“ODE parameter estimation”).</p>
<p>With fourth section, we will perform them with actual data of Tokyo/Japan as an example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">covsirphy</span> <span class="k">as</span> <span class="nn">cs</span>
<span class="kn">import</span> <span class="nn">sympy</span>
<span class="n">cs</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;3.0.0.dev15&#39;
</pre></div></div>
</div>
<div class="section" id="1.-Dynamics-of-phase-dependent-SIR-models">
<h2>1. Dynamics of phase-dependent SIR models<a class="headerlink" href="#1.-Dynamics-of-phase-dependent-SIR-models" title="Permalink to this heading"></a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">Dynamics</span></code> class, we will simulate phase-dependent SIR model with sample data (two phase) as an example.</p>
<div class="line-block">
<div class="line">The 0th phase: 01Jan2022 - 28Feb2022, rho=0.2, sigma=0.075 (preset)</div>
<div class="line">The 1st phase: 01Mar2022 - 30Jun2022, <strong>rho=0.4</strong>, sigma=0.075</div>
</div>
<p>tau value: 1440 [min] (default)</p>
<div class="section" id="1-1.-Define-the-0th-phase">
<h3>1-1. Define the 0th phase<a class="headerlink" href="#1-1.-Define-the-0th-phase" title="Permalink to this heading"></a></h3>
<p>As the first step, define the 0th (initial) phase with preset ODE parameter values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">),</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1440</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
      <th>Rt</th>
      <th>rho</th>
      <th>sigma</th>
      <th>1/beta [day]</th>
      <th>1/gamma [day]</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-06-30</td>
      <td>2.67</td>
      <td>0.2</td>
      <td>0.075</td>
      <td>5</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="1-2.-Define-the-1st-phase">
<h3>1-2. Define the 1st phase<a class="headerlink" href="#1-2.-Define-the-1st-phase" title="Permalink to this heading"></a></h3>
<p>Get the current settings of initial values of variables and ODE parameter values as a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code>. Then, edit it and register it to the instance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">before_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">before_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Susceptible</th>
      <th>Infected</th>
      <th>Recovered</th>
      <th>Fatal</th>
      <th>rho</th>
      <th>sigma</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-01-01</th>
      <td>999000</td>
      <td>1000</td>
      <td>0</td>
      <td>0</td>
      <td>0.2</td>
      <td>0.075</td>
    </tr>
    <tr>
      <th>2022-01-02</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-01-03</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-01-04</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-01-05</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-06-26</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-27</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-28</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-29</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-30</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
<p>181 rows × 6 columns</p>
</div></div>
</div>
<p>Without NAs:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">before_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Susceptible</th>
      <th>Infected</th>
      <th>Recovered</th>
      <th>Fatal</th>
      <th>rho</th>
      <th>sigma</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-01-01</th>
      <td>999000</td>
      <td>1000</td>
      <td>0</td>
      <td>0</td>
      <td>0.2</td>
      <td>0.075</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Edit the dataframe to set the ODE parameter values of the 1st phase.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">setting_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">setting_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">setting_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Susceptible</th>
      <th>Infected</th>
      <th>Recovered</th>
      <th>Fatal</th>
      <th>rho</th>
      <th>sigma</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-01-01</th>
      <td>999000</td>
      <td>1000</td>
      <td>0</td>
      <td>0</td>
      <td>0.2</td>
      <td>0.075</td>
    </tr>
    <tr>
      <th>2022-01-02</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-01-03</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-01-04</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-01-05</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2022-06-26</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-27</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-28</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-29</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2022-06-30</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
<p>181 rows × 6 columns</p>
</div></div>
</div>
<p>Without NAs:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">setting_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Susceptible</th>
      <th>Infected</th>
      <th>Recovered</th>
      <th>Fatal</th>
      <th>rho</th>
      <th>sigma</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-01-01</th>
      <td>999000</td>
      <td>1000</td>
      <td>0</td>
      <td>0</td>
      <td>0.2</td>
      <td>0.075</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>0.4</td>
      <td>0.075</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Register the new settings. Because initial values on 01Mar2022 will be calculated with analytical solution of the 0th phase, they were not registered manually.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">setting_df</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
      <th>Rt</th>
      <th>rho</th>
      <th>sigma</th>
      <th>1/beta [day]</th>
      <th>1/gamma [day]</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-02-28</td>
      <td>2.67</td>
      <td>0.2</td>
      <td>0.075</td>
      <td>5</td>
      <td>13</td>
    </tr>
    <tr>
      <th>1st</th>
      <td>2022-03-01</td>
      <td>2022-06-30</td>
      <td>5.33</td>
      <td>0.4</td>
      <td>0.075</td>
      <td>2</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>High-lightened:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_max</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;1/beta [day]&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style type="text/css">
#T_c7999_row0_col5, #T_c7999_row1_col2, #T_c7999_row1_col3 {
  background-color: yellow;
}
</style>
<table id="T_c7999">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_c7999_level0_col0" class="col_heading level0 col0" >Start</th>
      <th id="T_c7999_level0_col1" class="col_heading level0 col1" >End</th>
      <th id="T_c7999_level0_col2" class="col_heading level0 col2" >Rt</th>
      <th id="T_c7999_level0_col3" class="col_heading level0 col3" >rho</th>
      <th id="T_c7999_level0_col4" class="col_heading level0 col4" >sigma</th>
      <th id="T_c7999_level0_col5" class="col_heading level0 col5" >1/beta [day]</th>
      <th id="T_c7999_level0_col6" class="col_heading level0 col6" >1/gamma [day]</th>
    </tr>
    <tr>
      <th class="index_name level0" >Phase</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_c7999_level0_row0" class="row_heading level0 row0" >0th</th>
      <td id="T_c7999_row0_col0" class="data row0 col0" >2022-01-01 00:00:00</td>
      <td id="T_c7999_row0_col1" class="data row0 col1" >2022-02-28 00:00:00</td>
      <td id="T_c7999_row0_col2" class="data row0 col2" >2.670000</td>
      <td id="T_c7999_row0_col3" class="data row0 col3" >0.200000</td>
      <td id="T_c7999_row0_col4" class="data row0 col4" >0.075000</td>
      <td id="T_c7999_row0_col5" class="data row0 col5" >5</td>
      <td id="T_c7999_row0_col6" class="data row0 col6" >13</td>
    </tr>
    <tr>
      <th id="T_c7999_level0_row1" class="row_heading level0 row1" >1st</th>
      <td id="T_c7999_row1_col0" class="data row1 col0" >2022-03-01 00:00:00</td>
      <td id="T_c7999_row1_col1" class="data row1 col1" >2022-06-30 00:00:00</td>
      <td id="T_c7999_row1_col2" class="data row1 col2" >5.330000</td>
      <td id="T_c7999_row1_col3" class="data row1 col3" >0.400000</td>
      <td id="T_c7999_row1_col4" class="data row1 col4" >0.075000</td>
      <td id="T_c7999_row1_col5" class="data row1 col5" >2</td>
      <td id="T_c7999_row1_col6" class="data row1 col6" >13</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>With the same way, we can set additional phases, if necessary for your analysis.</p>
</div>
<div class="section" id="1-3.-Track-ODE-parameter-values">
<h3>1-3. Track ODE parameter values<a class="headerlink" href="#1-3.-Track-ODE-parameter-values" title="Permalink to this heading"></a></h3>
<p>Confirm the phase-dependent ODE parameter values and Rt (reproduction number) by plotting.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">track</span><span class="p">()</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Rt&quot;</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sample data of </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">: phase-dependent Rt values&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Reproduction number&quot;</span><span class="p">,</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;27Feb2022&quot;</span><span class="p">:</span> <span class="s2">&quot;02Mar2022&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">highlight_max</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;1/beta [day]&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_20_0.png" src="_images/04_phase_dependent_20_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style type="text/css">
#T_a4c33_row0_col3, #T_a4c33_row1_col3, #T_a4c33_row2_col0, #T_a4c33_row2_col1, #T_a4c33_row3_col0, #T_a4c33_row3_col1 {
  background-color: yellow;
}
</style>
<table id="T_a4c33">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_a4c33_level0_col0" class="col_heading level0 col0" >Rt</th>
      <th id="T_a4c33_level0_col1" class="col_heading level0 col1" >rho</th>
      <th id="T_a4c33_level0_col2" class="col_heading level0 col2" >sigma</th>
      <th id="T_a4c33_level0_col3" class="col_heading level0 col3" >1/beta [day]</th>
      <th id="T_a4c33_level0_col4" class="col_heading level0 col4" >1/gamma [day]</th>
    </tr>
    <tr>
      <th class="index_name level0" >Date</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_a4c33_level0_row0" class="row_heading level0 row0" >2022-02-27 00:00:00</th>
      <td id="T_a4c33_row0_col0" class="data row0 col0" >2.670000</td>
      <td id="T_a4c33_row0_col1" class="data row0 col1" >0.200000</td>
      <td id="T_a4c33_row0_col2" class="data row0 col2" >0.075000</td>
      <td id="T_a4c33_row0_col3" class="data row0 col3" >5</td>
      <td id="T_a4c33_row0_col4" class="data row0 col4" >13</td>
    </tr>
    <tr>
      <th id="T_a4c33_level0_row1" class="row_heading level0 row1" >2022-02-28 00:00:00</th>
      <td id="T_a4c33_row1_col0" class="data row1 col0" >2.670000</td>
      <td id="T_a4c33_row1_col1" class="data row1 col1" >0.200000</td>
      <td id="T_a4c33_row1_col2" class="data row1 col2" >0.075000</td>
      <td id="T_a4c33_row1_col3" class="data row1 col3" >5</td>
      <td id="T_a4c33_row1_col4" class="data row1 col4" >13</td>
    </tr>
    <tr>
      <th id="T_a4c33_level0_row2" class="row_heading level0 row2" >2022-03-01 00:00:00</th>
      <td id="T_a4c33_row2_col0" class="data row2 col0" >5.330000</td>
      <td id="T_a4c33_row2_col1" class="data row2 col1" >0.400000</td>
      <td id="T_a4c33_row2_col2" class="data row2 col2" >0.075000</td>
      <td id="T_a4c33_row2_col3" class="data row2 col3" >2</td>
      <td id="T_a4c33_row2_col4" class="data row2 col4" >13</td>
    </tr>
    <tr>
      <th id="T_a4c33_level0_row3" class="row_heading level0 row3" >2022-03-02 00:00:00</th>
      <td id="T_a4c33_row3_col0" class="data row3 col0" >5.330000</td>
      <td id="T_a4c33_row3_col1" class="data row3 col1" >0.400000</td>
      <td id="T_a4c33_row3_col2" class="data row3 col2" >0.075000</td>
      <td id="T_a4c33_row3_col3" class="data row3 col3" >2</td>
      <td id="T_a4c33_row3_col4" class="data row3 col4" >13</td>
    </tr>
  </tbody>
</table></div>
</div>
</div>
<div class="section" id="1-4.-Simulation">
<h3>1-4. Simulation<a class="headerlink" href="#1-4.-Simulation" title="Permalink to this heading"></a></h3>
<p>With <code class="docutils literal notranslate"><span class="pre">Dynamics().simulate()</span></code>, simulate the phase-dependent ODE model with numerical analysis of each phase. Because we did not specify the initial values on the start date of the 1st phase, simulated values on the 1st phase’s start date will be used as the initial values of the 1st phase.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Two-phase </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_22_0.png" src="_images/04_phase_dependent_22_0.png" />
</div>
</div>
<p>When we need convert model-specific variables to model-free variables (Susceptible/Infected/Fatal/Recovered), we will set <code class="docutils literal notranslate"><span class="pre">model_specific=False</span></code> (default). SIR model cannot separate “Fatal” cases and “Recovered” cases into different groups. Please use SIR-D model or SIR-F model if the following role is not acceptable for your analysis.</p>
<ul class="simple">
<li><p>“Fatal” is always equal to 0</p></li>
<li><p>“Recovered” is equal to “Fatal or Recovered” of SIR model</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Two-phase </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_24_0.png" src="_images/04_phase_dependent_24_0.png" />
</div>
</div>
</div>
<div class="section" id="1-5.-Observable-variables">
<h3>1-5. Observable variables<a class="headerlink" href="#1-5.-Observable-variables" title="Permalink to this heading"></a></h3>
<p>Actually, observable variables are Population/Confirmed/Infected/Recovered. We can calculate Population and Confirmed as follows.</p>
<ul class="simple">
<li><p>Confirmed = Infected + Fatal + Recovered</p></li>
<li><p>Population = Susceptible + Confirmed</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">real_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">real_df</span><span class="p">[</span><span class="s2">&quot;Confirmed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">real_df</span><span class="p">[[</span><span class="s2">&quot;Infected&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">real_df</span><span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">real_df</span><span class="p">[[</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">real_df</span> <span class="o">=</span> <span class="n">real_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">,</span> <span class="s2">&quot;Confirmed&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">,</span> <span class="s2">&quot;Fatal&quot;</span><span class="p">]]</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">real_df</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Two-phase </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> with observable variables&quot;</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_26_0.png" src="_images/04_phase_dependent_26_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="2.-S-R-change-point-analysis">
<h2>2. S-R change point analysis<a class="headerlink" href="#2.-S-R-change-point-analysis" title="Permalink to this heading"></a></h2>
<p>S-R change point analysis (S-R trend analysis) is a technique to find the change points of phases with actual time-series data.</p>
<div class="section" id="2-1.-S-R-plane">
<h3>2-1. S-R plane<a class="headerlink" href="#2-1.-S-R-plane" title="Permalink to this heading"></a></h3>
<p>Author of the Kaggle Notebook considered S-R plane. This idea (S-R plane) is from <a class="reference external" href="https://dc.etsu.edu/cgi/viewcontent.cgi?article=3102&amp;context=etd">Balkew, Teshome Mogessie, “The SIR Model When S(t) is a Multi-Exponential Function.” (2010).Electronic Theses and Dissertations.Paper 1747</a>. This is for simplest SIR model, but we can apply it to SIR-F model.</p>
<p>We will focus on the following equations of SIR-derived ODE models.</p>
<p><span class="math">\begin{align*}
& \frac{\mathrm{d}S}{\mathrm{d}T}= - \frac{\beta}{N} S I  \\
& \frac{\mathrm{d}R}{\mathrm{d}T}= \gamma I  \\
\end{align*}</span></p>
<p>When <span class="math notranslate nohighlight">\(I &gt; 0\)</span>, this leads to <span class="math">\begin{align*}
& \frac{\mathrm{d}S}{\mathrm{d}R}= - \frac{\beta}{N \gamma} S  \\
& \beta, \gamma, N: const.
\end{align*}</span></p>
<p>Because <span class="math notranslate nohighlight">\(S(0) = N\)</span>, <span class="math notranslate nohighlight">\(S\)</span> is a function of <span class="math notranslate nohighlight">\(R\)</span> as follows.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">sympy</span><span class="o">.</span><span class="n">Function</span><span class="p">)</span>
<span class="n">N</span><span class="p">,</span> <span class="n">R</span>  <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s2">&quot;N R&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\beta \gamma&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dS</span> <span class="o">=</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
<span class="n">sr</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">dsolve</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="n">dS</span><span class="p">,</span> <span class="n">hint</span><span class="o">=</span><span class="s2">&quot;separable&quot;</span><span class="p">,</span> <span class="n">ics</span><span class="o">=</span><span class="p">{</span><span class="n">S</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">N</span><span class="p">})</span>
<span class="n">sr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$\displaystyle S{\left(R \right)} = N e^{- \frac{R \beta}{N \gamma}}$</div></div>
</div>
</div>
<div class="section" id="2-2.-log(S)-vs.-R-plane">
<h3>2-2. log(S) vs. R plane<a class="headerlink" href="#2-2.-log(S)-vs.-R-plane" title="Permalink to this heading"></a></h3>
<p>Then,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sympy</span><span class="o">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">lhs</span><span class="p">)),</span> <span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sr</span><span class="o">.</span><span class="n">rhs</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$\displaystyle \log{\left(S{\left(R \right)} \right)} = \log{\left(N \right)} - \frac{R \beta}{N \gamma}$</div></div>
</div>
<p>Where <span class="math notranslate nohighlight">\(a=\cfrac{\beta}{N \gamma} \ (&gt; 0)\)</span>, <span class="math">\begin{align*}
& \log S_{(R)} = - a R + \log N  \\
& N: const.
\end{align*}</span></p>
<p><span class="math notranslate nohighlight">\(\log S\)</span> decreases constantly with increase of <span class="math notranslate nohighlight">\(R\)</span>, when the records follow a SIR-derived model and the parameter values of the model are constant. Plot of <span class="math notranslate nohighlight">\((x, y) = (R, \log S)\)</span> shows a line.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">)</span>
<span class="n">sirf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">from_sample</span><span class="p">()</span>
<span class="n">solved_df</span> <span class="o">=</span> <span class="n">sirf</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">sr_df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">solved_df</span><span class="p">))</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">sr_df</span><span class="p">[</span><span class="s2">&quot;log10(S)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">sr_df</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sr_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">: logS - R plane (corr: </span><span class="si">{</span><span class="n">corr</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;log10(S)&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_37_0.png" src="_images/04_phase_dependent_37_0.png" />
</div>
</div>
<p>Initial values on the first date was set, but the summary shows just a phase with no set ODE parameter values.</p>
<div class="line-block">
<div class="line">Limitations:</div>
<div class="line">Because <span class="math notranslate nohighlight">\(a=\cfrac{\beta}{N \gamma}\)</span>, the changes of <span class="math notranslate nohighlight">\(\alpha_1\)</span> and <span class="math notranslate nohighlight">\(\alpha_2\)</span> of SIR-D/SIR-F model cannot be detected.</div>
</div>
</div>
<div class="section" id="2-3.-Plane-of-phase-dependent-models">
<h3>2-3. Plane of phase-dependent models<a class="headerlink" href="#2-3.-Plane-of-phase-dependent-models" title="Permalink to this heading"></a></h3>
<p>Correlation coefficient is about -1.0 when ODE parameter values are constant The slope of the line may change when the ODE parameter values are changed.</p>
<p>Sample data of phase-dependent SIR-F model is here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">))</span>
<span class="c1"># Set some phases by changing ODE parameter values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;15Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">summary</span><span class="p">()[[</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">,</span> <span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">parameters</span><span class="p">]]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style type="text/css">
#T_22992_row0_col2 {
  background-color: #dddbec;
  color: #000000;
}
#T_22992_row0_col3, #T_22992_row0_col4, #T_22992_row1_col4, #T_22992_row1_col5, #T_22992_row2_col4, #T_22992_row3_col2, #T_22992_row3_col5, #T_22992_row4_col4, #T_22992_row4_col5, #T_22992_row4_col6, #T_22992_row5_col4, #T_22992_row5_col5, #T_22992_row5_col6 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_22992_row0_col5 {
  background-color: #dbdaeb;
  color: #000000;
}
#T_22992_row0_col6, #T_22992_row1_col6, #T_22992_row2_col2, #T_22992_row2_col5, #T_22992_row2_col6, #T_22992_row3_col4, #T_22992_row3_col6, #T_22992_row5_col3 {
  background-color: #fff7fb;
  color: #000000;
}
#T_22992_row1_col2 {
  background-color: #034369;
  color: #f1f1f1;
}
#T_22992_row1_col3, #T_22992_row2_col3, #T_22992_row3_col3, #T_22992_row4_col3 {
  background-color: #f0eaf4;
  color: #000000;
}
#T_22992_row4_col2, #T_22992_row5_col2 {
  background-color: #d8d7e9;
  color: #000000;
}
</style>
<table id="T_22992">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_22992_level0_col0" class="col_heading level0 col0" >Start</th>
      <th id="T_22992_level0_col1" class="col_heading level0 col1" >End</th>
      <th id="T_22992_level0_col2" class="col_heading level0 col2" >Rt</th>
      <th id="T_22992_level0_col3" class="col_heading level0 col3" >theta</th>
      <th id="T_22992_level0_col4" class="col_heading level0 col4" >kappa</th>
      <th id="T_22992_level0_col5" class="col_heading level0 col5" >rho</th>
      <th id="T_22992_level0_col6" class="col_heading level0 col6" >sigma</th>
    </tr>
    <tr>
      <th class="index_name level0" >Phase</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_22992_level0_row0" class="row_heading level0 row0" >0th</th>
      <td id="T_22992_row0_col0" class="data row0 col0" >2022-01-01 00:00:00</td>
      <td id="T_22992_row0_col1" class="data row0 col1" >2022-02-17 00:00:00</td>
      <td id="T_22992_row0_col2" class="data row0 col2" >2.5000</td>
      <td id="T_22992_row0_col3" class="data row0 col3" >0.0020</td>
      <td id="T_22992_row0_col4" class="data row0 col4" >0.0050</td>
      <td id="T_22992_row0_col5" class="data row0 col5" >0.2000</td>
      <td id="T_22992_row0_col6" class="data row0 col6" >0.0750</td>
    </tr>
    <tr>
      <th id="T_22992_level0_row1" class="row_heading level0 row1" >1st</th>
      <td id="T_22992_row1_col0" class="data row1 col0" >2022-02-18 00:00:00</td>
      <td id="T_22992_row1_col1" class="data row1 col1" >2022-02-23 00:00:00</td>
      <td id="T_22992_row1_col2" class="data row1 col2" >5.0000</td>
      <td id="T_22992_row1_col3" class="data row1 col3" >0.0002</td>
      <td id="T_22992_row1_col4" class="data row1 col4" >0.0050</td>
      <td id="T_22992_row1_col5" class="data row1 col5" >0.4000</td>
      <td id="T_22992_row1_col6" class="data row1 col6" >0.0750</td>
    </tr>
    <tr>
      <th id="T_22992_level0_row2" class="row_heading level0 row2" >2nd</th>
      <td id="T_22992_row2_col0" class="data row2 col0" >2022-02-24 00:00:00</td>
      <td id="T_22992_row2_col1" class="data row2 col1" >2022-02-28 00:00:00</td>
      <td id="T_22992_row2_col2" class="data row2 col2" >1.8700</td>
      <td id="T_22992_row2_col3" class="data row2 col3" >0.0002</td>
      <td id="T_22992_row2_col4" class="data row2 col4" >0.0050</td>
      <td id="T_22992_row2_col5" class="data row2 col5" >0.1500</td>
      <td id="T_22992_row2_col6" class="data row2 col6" >0.0750</td>
    </tr>
    <tr>
      <th id="T_22992_level0_row3" class="row_heading level0 row3" >3rd</th>
      <td id="T_22992_row3_col0" class="data row3 col0" >2022-03-01 00:00:00</td>
      <td id="T_22992_row3_col1" class="data row3 col1" >2022-03-07 00:00:00</td>
      <td id="T_22992_row3_col2" class="data row3 col2" >5.1300</td>
      <td id="T_22992_row3_col3" class="data row3 col3" >0.0002</td>
      <td id="T_22992_row3_col4" class="data row3 col4" >0.0030</td>
      <td id="T_22992_row3_col5" class="data row3 col5" >0.4000</td>
      <td id="T_22992_row3_col6" class="data row3 col6" >0.0750</td>
    </tr>
    <tr>
      <th id="T_22992_level0_row4" class="row_heading level0 row4" >4th</th>
      <td id="T_22992_row4_col0" class="data row4 col0" >2022-03-08 00:00:00</td>
      <td id="T_22992_row4_col1" class="data row4 col1" >2022-03-14 00:00:00</td>
      <td id="T_22992_row4_col2" class="data row4 col2" >2.5800</td>
      <td id="T_22992_row4_col3" class="data row4 col3" >0.0002</td>
      <td id="T_22992_row4_col4" class="data row4 col4" >0.0050</td>
      <td id="T_22992_row4_col5" class="data row4 col5" >0.4000</td>
      <td id="T_22992_row4_col6" class="data row4 col6" >0.1500</td>
    </tr>
    <tr>
      <th id="T_22992_level0_row5" class="row_heading level0 row5" >5th</th>
      <td id="T_22992_row5_col0" class="data row5 col0" >2022-03-15 00:00:00</td>
      <td id="T_22992_row5_col1" class="data row5 col1" >2022-06-30 00:00:00</td>
      <td id="T_22992_row5_col2" class="data row5 col2" >2.5800</td>
      <td id="T_22992_row5_col3" class="data row5 col3" >0.0000</td>
      <td id="T_22992_row5_col4" class="data row5 col4" >0.0050</td>
      <td id="T_22992_row5_col5" class="data row5 col5" >0.4000</td>
      <td id="T_22992_row5_col6" class="data row5 col6" >0.1500</td>
    </tr>
  </tbody>
</table></div>
</div>
<p>Dynamics:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">]],</span>
    <span class="n">color_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;Recovered&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">},</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Phase-dependent </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">: dynamics&quot;</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span> <span class="n">bbox_loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_44_0.png" src="_images/04_phase_dependent_44_0.png" />
</div>
</div>
<p>Plot of <span class="math notranslate nohighlight">\((R, \log _{10} S)\)</span>: with vertical lines on change points (= start dates of phases 1st - last):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">)</span>
<span class="c1"># Get (R, log10S)</span>
<span class="n">sr_df</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sr</span><span class="p">(</span><span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">())</span>
<span class="c1"># Plotting</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sr_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Phase-dependent </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">: logS - R plane</span><span class="se">\n</span><span class="s2">with vertical lines on change points&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;log10(S)&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="p">[</span><span class="n">sr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dyn</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_46_0.png" src="_images/04_phase_dependent_46_0.png" />
</div>
</div>
<p>With the plotting, we can confirm most of the change points (except for 5th - 6th: difficult because the change was for <span class="math notranslate nohighlight">\(\alpha_1\)</span>).</p>
</div>
<div class="section" id="2.4-Time-series-segmentation">
<h3>2.4 Time-series segmentation<a class="headerlink" href="#2.4-Time-series-segmentation" title="Permalink to this heading"></a></h3>
<p>The previous sub-sections demonstrated that change points of S-R trend suggest change points of phases. Here, we will detect the change points of S-R trend with <code class="docutils literal notranslate"><span class="pre">Dynamics().detect()</span></code> via <code class="docutils literal notranslate"><span class="pre">Dynamics.segment()</span></code>. They uses <a class="reference external" href="https://github.com/deepcharles/ruptures">ruptures library: change point detection in Python</a> for off-line change point detection.</p>
<p>We will prepare a dataset which has the 0th - 5th phase.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">),</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1440</span><span class="p">)</span>
<span class="c1"># Set some phases by changing ODE parameter values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;15Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Simulation</span>
<span class="n">sim_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sim_df</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Prepared dataset with phases and </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_50_0.png" src="_images/04_phase_dependent_50_0.png" />
</div>
</div>
<p>Create an instance of <code class="docutils literal notranslate"><span class="pre">Dynamics</span></code> with the prepared data. Note that the instance does not know the change points of phases.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_sim</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sim_df</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sample data&quot;</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">display</span><span class="p">(</span><span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-06-30</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().detect()</span></code> performs S-R change point analysis (trend analysis) and show the trend on S-R plane. Dot lines are the change points of phases.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">algo</span></code> argument, we can select the algorithm and models to detect the change points from “Binseg-normal” (default), “Pelt-rbf”, “Binseg-rbf”, “BottomUp-rbf”, “BottomUp-normal”. Please refer to <a class="reference external" href="https://centre-borelli.github.io/ruptures-docs/">the documentation of ruptures library</a>.</p>
<p>Additionally, we can specify the minimum size of phases with argument <code class="docutils literal notranslate"><span class="pre">min_size=7</span></code> (as default, [days]).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span><span class="p">,</span> <span class="n">fit_df</span> <span class="o">=</span> <span class="n">dyn_sim</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">algo</span><span class="o">=</span><span class="s2">&quot;Binseg-rbf&quot;</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># List of change points</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="c1"># Plotted values</span>
<span class="n">display</span><span class="p">(</span><span class="n">fit_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_54_0.png" src="_images/04_phase_dependent_54_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[Timestamp(&#39;2022-02-11 00:00:00&#39;),
 Timestamp(&#39;2022-02-20 00:00:00&#39;),
 Timestamp(&#39;2022-03-04 00:00:00&#39;),
 Timestamp(&#39;2022-03-14 00:00:00&#39;)]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Actual</th>
      <th>0th</th>
      <th>1st</th>
      <th>2nd</th>
      <th>3rd</th>
      <th>4th</th>
      <th>Fitted</th>
    </tr>
    <tr>
      <th>R</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.999565</td>
      <td>5.999569</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.999569</td>
    </tr>
    <tr>
      <th>80</th>
      <td>5.999473</td>
      <td>5.999476</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.999476</td>
    </tr>
    <tr>
      <th>169</th>
      <td>5.999369</td>
      <td>5.999373</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.999373</td>
    </tr>
    <tr>
      <th>271</th>
      <td>5.999252</td>
      <td>5.999255</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.999255</td>
    </tr>
    <tr>
      <th>385</th>
      <td>5.999120</td>
      <td>5.999123</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.999123</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>910075</th>
      <td>4.652981</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.652989</td>
      <td>4.652989</td>
    </tr>
    <tr>
      <th>910076</th>
      <td>4.652981</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.652988</td>
      <td>4.652988</td>
    </tr>
    <tr>
      <th>910077</th>
      <td>4.652981</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.652986</td>
      <td>4.652986</td>
    </tr>
    <tr>
      <th>910078</th>
      <td>4.652981</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.652985</td>
      <td>4.652985</td>
    </tr>
    <tr>
      <th>910079</th>
      <td>4.652981</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.652984</td>
      <td>4.652984</td>
    </tr>
  </tbody>
</table>
<p>153 rows × 7 columns</p>
</div></div>
</div>
<p>Note that detected phases are un-registered to the instance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-06-30</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>To perform time-series segmentation with S-R trend analysis, we will use <code class="docutils literal notranslate"><span class="pre">Dynamics().segment()</span></code>, which accepts all keyword arguments of <code class="docutils literal notranslate"><span class="pre">Dynamics().detect()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_sim</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">algo</span><span class="o">=</span><span class="s2">&quot;Binseg-rbf&quot;</span><span class="p">,</span> <span class="n">min_size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_58_0.png" src="_images/04_phase_dependent_58_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-02-10</td>
    </tr>
    <tr>
      <th>1st</th>
      <td>2022-02-11</td>
      <td>2022-02-19</td>
    </tr>
    <tr>
      <th>2nd</th>
      <td>2022-02-20</td>
      <td>2022-03-03</td>
    </tr>
    <tr>
      <th>3rd</th>
      <td>2022-03-04</td>
      <td>2022-03-13</td>
    </tr>
    <tr>
      <th>4th</th>
      <td>2022-03-14</td>
      <td>2022-06-30</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If we need to add new change points or over-write change points, we will use <code class="docutils literal notranslate"><span class="pre">Dynamics().segment(points=&lt;list&gt;,</span> <span class="pre">overwrite=&lt;bool&gt;)</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Over-write</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="s2">&quot;01Jun2022&quot;</span><span class="p">],</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Add</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;01May2022&quot;</span><span class="p">],</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-02-28</td>
    </tr>
    <tr>
      <th>1st</th>
      <td>2022-03-01</td>
      <td>2022-04-30</td>
    </tr>
    <tr>
      <th>2nd</th>
      <td>2022-05-01</td>
      <td>2022-05-31</td>
    </tr>
    <tr>
      <th>3rd</th>
      <td>2022-06-01</td>
      <td>2022-06-30</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="3.-ODE-parameter-estimation">
<h2>3. ODE parameter estimation<a class="headerlink" href="#3.-ODE-parameter-estimation" title="Permalink to this heading"></a></h2>
<p>This section demonstrates how to estimate tau value (constant for all phases) and the ODE parameter values of phases.</p>
<div class="section" id="3.1-Preparation">
<h3>3.1 Preparation<a class="headerlink" href="#3.1-Preparation" title="Permalink to this heading"></a></h3>
<p>Create an <code class="docutils literal notranslate"><span class="pre">Dynamics()</span></code> instance which has a dataset with 6 phases (the 0th - 5th). The instance knows change points, but does not know tau value and ODE parameter values.</p>
<p>Create dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_sample</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;01Jan2022&quot;</span><span class="p">,</span> <span class="s2">&quot;30Jun2022&quot;</span><span class="p">),</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1440</span><span class="p">)</span>
<span class="c1"># Set some phases by changing ODE parameter values</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;15Mar2022&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0000</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.150</span><span class="p">]</span>
<span class="n">dyn</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Simulation</span>
<span class="n">sim_df</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model_specific</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">sim_df</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Prepared dataset with phases and </span><span class="si">{</span><span class="n">dyn</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_64_0.png" src="_images/04_phase_dependent_64_0.png" />
</div>
</div>
<p>Create <code class="docutils literal notranslate"><span class="pre">Dynamics()</span></code> instance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_est</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sim_df</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sample data&quot;</span><span class="p">)</span>
<span class="n">dyn_est</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;18Feb2022&quot;</span><span class="p">,</span> <span class="s2">&quot;24Feb2022&quot;</span><span class="p">,</span> <span class="s2">&quot;01Mar2022&quot;</span><span class="p">,</span> <span class="s2">&quot;08Mar2022&quot;</span><span class="p">,</span> <span class="s2">&quot;15Mar2022&quot;</span><span class="p">])</span>
<span class="c1"># Show tau value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tau value [min]: </span><span class="si">{</span><span class="n">dyn_est</span><span class="o">.</span><span class="n">tau</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;un-set&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">display</span><span class="p">(</span><span class="n">dyn_est</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Tau value [min]: un-set
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-02-17</td>
    </tr>
    <tr>
      <th>1st</th>
      <td>2022-02-18</td>
      <td>2022-02-23</td>
    </tr>
    <tr>
      <th>2nd</th>
      <td>2022-02-24</td>
      <td>2022-02-28</td>
    </tr>
    <tr>
      <th>3rd</th>
      <td>2022-03-01</td>
      <td>2022-03-07</td>
    </tr>
    <tr>
      <th>4th</th>
      <td>2022-03-08</td>
      <td>2022-03-14</td>
    </tr>
    <tr>
      <th>5th</th>
      <td>2022-03-15</td>
      <td>2022-06-30</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="3.2-Tau-estimation">
<h3>3.2 Tau estimation<a class="headerlink" href="#3.2-Tau-estimation" title="Permalink to this heading"></a></h3>
<p>Before ODE parameter estimation, we need to select tau value [min]. Tau value is expected to be constant for all phases because tau value is a parameter used to convert actual time (with unit [min]) to time steps (without units) from divisors of 1440).</p>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_tau(metric=&quot;RMSLE&quot;,</span> <span class="pre">q=0.5,</span> <span class="pre">digits=None,</span> <span class="pre">n_jobs=None)</span></code> (as default) sets the best tau value for the registered data, estimating ODE parameters with quantiles.</p>
<p>Arguments:</p>
<ul class="simple">
<li><p>metric (str): metric name for scoring when selecting best tau value</p></li>
<li><p>q (float): the quantiles to compute, values between (0, 1)</p></li>
<li><p>digits (int or None): effective digits of ODE parameter values or None (skip rounding)</p></li>
<li><p>n_jobs (int or None): the number of parallel jobs or None (CPU count)</p></li>
</ul>
<p>Metrics (selectable candidates of <code class="docutils literal notranslate"><span class="pre">metric</span></code>):</p>
<ul class="simple">
<li><p>ME: maximum residual error</p></li>
<li><p>MAE: mean absolute error</p></li>
<li><p>MSE: mean square error</p></li>
<li><p>MSLE: mean squared logarithmic error</p></li>
<li><p>MAPE: mean absolute percentage error</p></li>
<li><p>RMSE: root mean squared error</p></li>
<li><p>RMSLE: root mean squared logarithmic error</p></li>
<li><p>R2: the coefficient of determination</p></li>
</ul>
<p>For example, RMSLE score will be calculated with the following equation. <span class="math">\begin{align*}
\mathrm{RMSLE} = \sqrt{\cfrac{1}{n}\sum_{i=1}^{n}(log_{10}(A_{i} + 1) - log_{10}(P_{i} + 1))^2}
\end{align*}</span> Where <span class="math notranslate nohighlight">\(A\)</span> is the observed (actual) values, <span class="math notranslate nohighlight">\(P\)</span> is estimated (predicted) values. Variables are <span class="math notranslate nohighlight">\(S (i=1), I (i=2), R (i=3)\ \mathrm{and}\ F (i=n=4)\)</span> for SIR-F model. When RMSLE score is low, hyperparameter estimation is highly accurate. Please refer to external sites, including <a class="reference external" href="https://medium.com/analytics-vidhya/root-mean-square-log-error-rmse-vs-rmlse-935c6cc1802a">Medium: What’s the Difference Between RMSE and RMSLE?</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metric</span> <span class="o">=</span> <span class="s2">&quot;RMSLE&quot;</span>
<span class="n">tau</span><span class="p">,</span> <span class="n">score_df</span> <span class="o">=</span> <span class="n">dyn_est</span><span class="o">.</span><span class="n">estimate_tau</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tau value [min]: </span><span class="si">{</span><span class="n">dyn_est</span><span class="o">.</span><span class="n">tau</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;un-set&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">score_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tau estimation: </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> scores (selected tau: </span><span class="si">{</span><span class="n">tau</span><span class="si">}</span><span class="s2"> [min])&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Tau value [min]&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Tau value [min]: 48
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_68_1.png" src="_images/04_phase_dependent_68_1.png" />
</div>
</div>
</div>
<div class="section" id="3.3-ODE-parameter-estimation">
<h3>3.3 ODE parameter estimation<a class="headerlink" href="#3.3-ODE-parameter-estimation" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_params(metric=&quot;RMSLE&quot;,</span> <span class="pre">digits=None,</span> <span class="pre">n_jobs=None,</span> <span class="pre">**kwargs)</span></code> (as default) sets ODE parameter values optimized for the registered data with hyperparameter optimization using <a class="reference external" href="https://github.com/optuna/optuna">Optuna library</a>.</p>
<p>Arguments of <code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_params</span></code>:</p>
<ul class="simple">
<li><p>metric (str): metric name for scoring when optimizing ODE parameter values of phases</p></li>
<li><p>digits (int or None): effective digits of ODE parameter values or None (skip rounding)</p></li>
<li><p>n_jobs (int or None): the number of parallel jobs or None (CPU count)</p></li>
<li><p>**kwargs: keyword arguments of optimization</p>
<ul>
<li><p>quantiles (tuple(int, int)): quantiles to cut parameter range, like confidence interval, (0.1, 0.9) as default</p></li>
<li><p>timeout (int): timeout of optimization, 180 as default</p></li>
<li><p>timeout_iteration (int): timeout of one iteration, 1 as default</p></li>
<li><p>tail_n (int): the number of iterations to decide whether score did not change for the last iterations, 4 as default</p></li>
<li><p>allowance (tuple(float, float)): the allowance of the max predicted values, (0.99, 1.01) as default</p></li>
<li><p>pruner (str): kind of pruner (hyperband, median, threshold or percentile), “threshold” as default</p></li>
<li><p>upper (float): works for “threshold” pruner, intermediate score is larger than this value, it prunes, 0.5 as default</p></li>
<li><p>percentile (float): works for “Percentile” pruner, the best intermediate value is in the bottom percentile among trials, it prunes, 50 as default</p></li>
<li><p>constant_liar (bool): whether use constant liar to reduce search effort or not, False as default</p></li>
</ul>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">est_df</span> <span class="o">=</span> <span class="n">dyn_est</span><span class="o">.</span><span class="n">estimate_params</span><span class="p">()</span>
<span class="c1"># Show RMSLE scores pf phases</span>
<span class="n">est_df</span> <span class="o">=</span> <span class="n">est_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">est_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Start&quot;</span>
<span class="n">display</span><span class="p">(</span><span class="n">est_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-04-15 at 15:42:38 | <span class="ansi-bold">INFO</span> | <span class="ansi-bold">
&lt;SIR-F Model: parameter estimation&gt;</span>
2023-04-15 at 15:42:38 | <span class="ansi-bold">INFO</span> | <span class="ansi-bold">Running optimization with 2 CPUs...</span>
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "0404f603f327472f9541db8cb541ecc4"}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-04-15 at 15:43:08 | <span class="ansi-bold">INFO</span> | <span class="ansi-bold">Completed optimization. Total: 0 min 29 sec
</span>
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>theta</th>
      <th>kappa</th>
      <th>rho</th>
      <th>sigma</th>
      <th>RMSLE</th>
      <th>Trials</th>
      <th>Runtime</th>
    </tr>
    <tr>
      <th>Start</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2022-02-18</th>
      <td>0.000287</td>
      <td>0.000187</td>
      <td>0.015575</td>
      <td>0.002754</td>
      <td>0.056957</td>
      <td>121</td>
      <td>0 min  4 sec</td>
    </tr>
    <tr>
      <th>2022-02-24</th>
      <td>0.000004</td>
      <td>0.000212</td>
      <td>0.006512</td>
      <td>0.003173</td>
      <td>0.037987</td>
      <td>151</td>
      <td>0 min  5 sec</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>0.000041</td>
      <td>0.000116</td>
      <td>0.016426</td>
      <td>0.002858</td>
      <td>0.059272</td>
      <td>149</td>
      <td>0 min  5 sec</td>
    </tr>
    <tr>
      <th>2022-03-08</th>
      <td>0.000222</td>
      <td>0.000205</td>
      <td>0.016925</td>
      <td>0.00611</td>
      <td>0.061422</td>
      <td>278</td>
      <td>0 min 10 sec</td>
    </tr>
    <tr>
      <th>2022-01-01</th>
      <td>0.000542</td>
      <td>0.000175</td>
      <td>0.006634</td>
      <td>0.002461</td>
      <td>0.007695</td>
      <td>497</td>
      <td>0 min 27 sec</td>
    </tr>
    <tr>
      <th>2022-03-15</th>
      <td>0.223396</td>
      <td>0.000171</td>
      <td>0.005088</td>
      <td>0.004658</td>
      <td>0.129395</td>
      <td>75</td>
      <td>0 min  4 sec</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_est</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
      <th>Rt</th>
      <th>theta</th>
      <th>kappa</th>
      <th>rho</th>
      <th>sigma</th>
      <th>alpha1 [-]</th>
      <th>1/alpha2 [day]</th>
      <th>1/beta [day]</th>
      <th>1/gamma [day]</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2022-01-01</td>
      <td>2022-02-17</td>
      <td>2.52</td>
      <td>0.000542</td>
      <td>0.000175</td>
      <td>0.006634</td>
      <td>0.002461</td>
      <td>0.001</td>
      <td>191</td>
      <td>5</td>
      <td>14</td>
    </tr>
    <tr>
      <th>1st</th>
      <td>2022-02-18</td>
      <td>2022-02-23</td>
      <td>5.29</td>
      <td>0.000287</td>
      <td>0.000187</td>
      <td>0.015575</td>
      <td>0.002754</td>
      <td>0.0</td>
      <td>178</td>
      <td>2</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2nd</th>
      <td>2022-02-24</td>
      <td>2022-02-28</td>
      <td>1.92</td>
      <td>0.000004</td>
      <td>0.000212</td>
      <td>0.006512</td>
      <td>0.003173</td>
      <td>0.0</td>
      <td>157</td>
      <td>5</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3rd</th>
      <td>2022-03-01</td>
      <td>2022-03-07</td>
      <td>5.52</td>
      <td>0.000041</td>
      <td>0.000116</td>
      <td>0.016426</td>
      <td>0.002858</td>
      <td>0.0</td>
      <td>289</td>
      <td>2</td>
      <td>12</td>
    </tr>
    <tr>
      <th>4th</th>
      <td>2022-03-08</td>
      <td>2022-03-14</td>
      <td>2.68</td>
      <td>0.000222</td>
      <td>0.000205</td>
      <td>0.016925</td>
      <td>0.00611</td>
      <td>0.0</td>
      <td>163</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>5th</th>
      <td>2022-03-15</td>
      <td>2022-06-30</td>
      <td>0.82</td>
      <td>0.223396</td>
      <td>0.000171</td>
      <td>0.005088</td>
      <td>0.004658</td>
      <td>0.223</td>
      <td>195</td>
      <td>7</td>
      <td>7</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="4.-With-actual-data">
<h2>4. With actual data<a class="headerlink" href="#4.-With-actual-data" title="Permalink to this heading"></a></h2>
<p>This section demonstrates how to divide actual time-series data with phases (“S-R change point analysis”) and to estimate ODE parameter values of phases (“ODE parameter estimation”).</p>
<div class="section" id="4-1.-Data-preparation">
<h3>4-1. Data preparation<a class="headerlink" href="#4-1.-Data-preparation" title="Permalink to this heading"></a></h3>
<p>Prepare actual prefecture-level time-series data in Japan for demonstration.</p>
<p>Download the dataset.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">DataEngineer</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">databases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;japan&quot;</span><span class="p">,</span> <span class="s2">&quot;covid19dh&quot;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<p>Data cleaning, transformation, subsetting, complement.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eng</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
<span class="n">eng</span><span class="o">.</span><span class="n">transform</span><span class="p">()</span>
<span class="n">actual_df</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">geo</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Japan&quot;</span><span class="p">,),</span> <span class="n">variables</span><span class="o">=</span><span class="s2">&quot;SIRF&quot;</span><span class="p">,</span> <span class="n">complement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
<span class="n">actual_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
monotonic increasing complemented confirmed data and
monotonic increasing complemented fatal data and
fully complemented recovered data
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Susceptible</th>
      <th>Infected</th>
      <th>Recovered</th>
      <th>Fatal</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-04-11</th>
      <td>92967738.0</td>
      <td>121634</td>
      <td>33365588</td>
      <td>74140</td>
    </tr>
    <tr>
      <th>2023-04-12</th>
      <td>92957559.0</td>
      <td>125475</td>
      <td>33371894</td>
      <td>74172</td>
    </tr>
    <tr>
      <th>2023-04-13</th>
      <td>92948427.0</td>
      <td>131713</td>
      <td>33374770</td>
      <td>74190</td>
    </tr>
    <tr>
      <th>2023-04-14</th>
      <td>92940007.0</td>
      <td>131697</td>
      <td>33383190</td>
      <td>74206</td>
    </tr>
    <tr>
      <th>2023-04-15</th>
      <td>92931406.0</td>
      <td>131973</td>
      <td>33391493</td>
      <td>74228</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Plotting: removed “Susceptible” from the figure because “Susceptible” &gt;&gt; max(“Infected”, “Infected”, “Recovered”).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span><span class="n">actual_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Actual data in Japan&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_79_0.png" src="_images/04_phase_dependent_79_0.png" />
</div>
</div>
<p>With the data, create an instance of <code class="docutils literal notranslate"><span class="pre">Dynamics</span></code> class.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_act</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">Dynamics</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">SIRFModel</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">actual_df</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Japan&quot;</span><span class="p">)</span>
<span class="c1"># Show registered values</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">register</span><span class="p">()</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Susceptible</th>
      <th>Infected</th>
      <th>Recovered</th>
      <th>Fatal</th>
      <th>theta</th>
      <th>kappa</th>
      <th>rho</th>
      <th>sigma</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-04-11</th>
      <td>92967738</td>
      <td>121634</td>
      <td>33365588</td>
      <td>74140</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2023-04-12</th>
      <td>92957559</td>
      <td>125475</td>
      <td>33371894</td>
      <td>74172</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2023-04-13</th>
      <td>92948427</td>
      <td>131713</td>
      <td>33374770</td>
      <td>74190</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2023-04-14</th>
      <td>92940007</td>
      <td>131697</td>
      <td>33383190</td>
      <td>74206</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2023-04-15</th>
      <td>92931406</td>
      <td>131973</td>
      <td>33391493</td>
      <td>74228</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show summary</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2020-02-06</td>
      <td>2023-04-15</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="4-2.-Time-series-segmentation">
<h3>4-2. Time-series segmentation<a class="headerlink" href="#4-2.-Time-series-segmentation" title="Permalink to this heading"></a></h3>
<p>With <code class="docutils literal notranslate"><span class="pre">Dynamics.segment()</span></code>, we will apply S-R change point analysis (trend analysis) to the prepared actual data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_act</span><span class="o">.</span><span class="n">segment</span><span class="p">();</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_84_0.png" src="_images/04_phase_dependent_84_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Phase</th>
      <th>0th</th>
      <th>1st</th>
      <th>2nd</th>
      <th>3rd</th>
      <th>4th</th>
      <th>5th</th>
      <th>6th</th>
      <th>7th</th>
      <th>8th</th>
      <th>9th</th>
      <th>...</th>
      <th>54th</th>
      <th>55th</th>
      <th>56th</th>
      <th>57th</th>
      <th>58th</th>
      <th>59th</th>
      <th>60th</th>
      <th>61st</th>
      <th>62nd</th>
      <th>63rd</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Start</th>
      <td>2020-02-06</td>
      <td>2020-08-11</td>
      <td>2020-11-17</td>
      <td>2020-12-25</td>
      <td>2021-01-17</td>
      <td>2021-02-11</td>
      <td>2021-04-04</td>
      <td>2021-04-22</td>
      <td>2021-05-07</td>
      <td>2021-05-25</td>
      <td>...</td>
      <td>2022-12-27</td>
      <td>2023-01-04</td>
      <td>2023-01-13</td>
      <td>2023-01-24</td>
      <td>2023-01-31</td>
      <td>2023-02-09</td>
      <td>2023-02-21</td>
      <td>2023-03-02</td>
      <td>2023-03-12</td>
      <td>2023-03-30</td>
    </tr>
    <tr>
      <th>End</th>
      <td>2020-08-10</td>
      <td>2020-11-16</td>
      <td>2020-12-24</td>
      <td>2021-01-16</td>
      <td>2021-02-10</td>
      <td>2021-04-03</td>
      <td>2021-04-21</td>
      <td>2021-05-06</td>
      <td>2021-05-24</td>
      <td>2021-07-01</td>
      <td>...</td>
      <td>2023-01-03</td>
      <td>2023-01-12</td>
      <td>2023-01-23</td>
      <td>2023-01-30</td>
      <td>2023-02-08</td>
      <td>2023-02-20</td>
      <td>2023-03-01</td>
      <td>2023-03-11</td>
      <td>2023-03-29</td>
      <td>2023-04-15</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 64 columns</p>
</div></div>
</div>
</div>
<div class="section" id="4-3.-Parameter-estimation">
<h3>4-3. Parameter estimation<a class="headerlink" href="#4-3.-Parameter-estimation" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Dynamics().estimate(**kwargs)</span></code> performs <code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_tau()</span></code> and <code class="docutils literal notranslate"><span class="pre">Dynamics().estimate_params()</span></code> in order.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dyn_act</span><span class="o">.</span><span class="n">estimate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tau value [min]: </span><span class="si">{</span><span class="n">dyn_act</span><span class="o">.</span><span class="n">tau</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;un-set&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Show summary</span>
<span class="n">dyn_act</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-04-15 at 15:44:10 | <span class="ansi-bold">INFO</span> | <span class="ansi-bold">
&lt;SIR-F Model: parameter estimation&gt;</span>
2023-04-15 at 15:44:10 | <span class="ansi-bold">INFO</span> | <span class="ansi-bold">Running optimization with 2 CPUs...</span>
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "287de0b3bf654bcbae03be615d37934b"}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-04-15 at 15:48:08 | <span class="ansi-bold">INFO</span> | <span class="ansi-bold">Completed optimization. Total: 3 min 58 sec
</span>
Tau value [min]: 15
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Start</th>
      <th>End</th>
      <th>Rt</th>
      <th>theta</th>
      <th>kappa</th>
      <th>rho</th>
      <th>sigma</th>
      <th>alpha1 [-]</th>
      <th>1/alpha2 [day]</th>
      <th>1/beta [day]</th>
      <th>1/gamma [day]</th>
    </tr>
    <tr>
      <th>Phase</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0th</th>
      <td>2020-02-06</td>
      <td>2020-08-10</td>
      <td>1.44</td>
      <td>0.0535</td>
      <td>0.000012</td>
      <td>0.001371</td>
      <td>0.000888</td>
      <td>0.054</td>
      <td>874</td>
      <td>8</td>
      <td>12</td>
    </tr>
    <tr>
      <th>1st</th>
      <td>2020-08-11</td>
      <td>2020-11-16</td>
      <td>0.86</td>
      <td>0.000455</td>
      <td>0.000005</td>
      <td>0.000636</td>
      <td>0.000733</td>
      <td>0.0</td>
      <td>2059</td>
      <td>16</td>
      <td>14</td>
    </tr>
    <tr>
      <th>2nd</th>
      <td>2020-11-17</td>
      <td>2020-12-24</td>
      <td>1.55</td>
      <td>0.00067</td>
      <td>0.00001</td>
      <td>0.000801</td>
      <td>0.000505</td>
      <td>0.001</td>
      <td>1082</td>
      <td>13</td>
      <td>21</td>
    </tr>
    <tr>
      <th>3rd</th>
      <td>2020-12-25</td>
      <td>2021-01-16</td>
      <td>1.62</td>
      <td>0.000372</td>
      <td>0.000009</td>
      <td>0.000767</td>
      <td>0.000466</td>
      <td>0.0</td>
      <td>1218</td>
      <td>14</td>
      <td>22</td>
    </tr>
    <tr>
      <th>4th</th>
      <td>2021-01-17</td>
      <td>2021-02-10</td>
      <td>0.75</td>
      <td>0.002909</td>
      <td>0.000009</td>
      <td>0.000493</td>
      <td>0.000645</td>
      <td>0.003</td>
      <td>1198</td>
      <td>21</td>
      <td>16</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>59th</th>
      <td>2023-02-09</td>
      <td>2023-02-20</td>
      <td>0.54</td>
      <td>0.001503</td>
      <td>0.000002</td>
      <td>0.000522</td>
      <td>0.000971</td>
      <td>0.002</td>
      <td>4278</td>
      <td>20</td>
      <td>11</td>
    </tr>
    <tr>
      <th>60th</th>
      <td>2023-02-21</td>
      <td>2023-03-01</td>
      <td>0.55</td>
      <td>0.001581</td>
      <td>0.000004</td>
      <td>0.000571</td>
      <td>0.001033</td>
      <td>0.002</td>
      <td>2629</td>
      <td>18</td>
      <td>10</td>
    </tr>
    <tr>
      <th>61st</th>
      <td>2023-03-02</td>
      <td>2023-03-11</td>
      <td>0.73</td>
      <td>0.000925</td>
      <td>0.000003</td>
      <td>0.000834</td>
      <td>0.001134</td>
      <td>0.001</td>
      <td>3228</td>
      <td>12</td>
      <td>9</td>
    </tr>
    <tr>
      <th>62nd</th>
      <td>2023-03-12</td>
      <td>2023-03-29</td>
      <td>1.58</td>
      <td>0.001157</td>
      <td>0.000002</td>
      <td>0.000589</td>
      <td>0.000371</td>
      <td>0.001</td>
      <td>4775</td>
      <td>18</td>
      <td>28</td>
    </tr>
    <tr>
      <th>63rd</th>
      <td>2023-03-30</td>
      <td>2023-04-15</td>
      <td>0.78</td>
      <td>0.000048</td>
      <td>0.000002</td>
      <td>0.000651</td>
      <td>0.000833</td>
      <td>0.0</td>
      <td>6439</td>
      <td>16</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
<p>64 rows × 11 columns</p>
</div></div>
</div>
</div>
<div class="section" id="4-4.-Accuracy-evaluation">
<h3>4-4. Accuracy evaluation<a class="headerlink" href="#4-4.-Accuracy-evaluation" title="Permalink to this heading"></a></h3>
<p>Compare the simulated results and actual records, and evaluate the differences.</p>
<p>Arguments: - date_range (tuple of (str or pandas.Timestamp or None) or None): range of dates to evaluate or None (the first and the last date) - metric (str): metric to evaluate the difference, “RMSLE” as default - display (bool): whether display figure of comparison or not - kwargs: keyword arguments of <code class="docutils literal notranslate"><span class="pre">covsirphy.compare_plot()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metric</span> <span class="o">=</span> <span class="s2">&quot;RMSLE&quot;</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.4</span><span class="si">}</span><span class="s2"> (overall score for time-series segmentation, tau estimation and ODE parameter estimation)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_88_0.png" src="_images/04_phase_dependent_88_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RMSLE: 0.5598 (overall score for time-series segmentation, tau estimation and ODE parameter estimation)
</pre></div></div>
</div>
</div>
<div class="section" id="4-5.-Simulation">
<h3>4-5. Simulation<a class="headerlink" href="#4-5.-Simulation" title="Permalink to this heading"></a></h3>
<p>Simulate the dynamics with the estimated parameter sets of phases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simulated_df</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">simulated_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Simulated data in Tokyo/Japan&quot;</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="n">dyn_act</span><span class="o">.</span><span class="n">start_dates</span><span class="p">()[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_91_0.png" src="_images/04_phase_dependent_91_0.png" />
</div>
</div>
<p>When we need to simulate for the last 30 days, we can use <code class="docutils literal notranslate"><span class="pre">Dynamics().parse_days(days=-30,</span> <span class="pre">ref=&quot;last&quot;)</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">parse_days</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">)</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">simulated_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">end</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Simulated: Japan, </span><span class="si">{</span><span class="n">start</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">y_integer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_93_0.png" src="_images/04_phase_dependent_93_0.png" />
</div>
</div>
<p>When we need to perform simulation for th 5th and 6th phase, We can use <code class="docutils literal notranslate"><span class="pre">Dynamics().parse_phases(phases=[&quot;5th&quot;,</span> <span class="pre">&quot;6th&quot;])</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">parse_phases</span><span class="p">(</span><span class="n">phases</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;5th&quot;</span><span class="p">,</span> <span class="s2">&quot;6th&quot;</span><span class="p">])</span>
<span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
    <span class="n">simulated_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Susceptible&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span> <span class="n">end</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Simulated: Japan, </span><span class="si">{</span><span class="n">start</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">end</span><span class="si">:</span><span class="s2"> %Y-%m-%d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">),</span>
    <span class="n">y_integer</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_95_0.png" src="_images/04_phase_dependent_95_0.png" />
</div>
</div>
</div>
<div class="section" id="4-6.-Tracking-of-ODE-parameters">
<h3>4-6. Tracking of ODE parameters<a class="headerlink" href="#4-6.-Tracking-of-ODE-parameters" title="Permalink to this heading"></a></h3>
<p>Track the estimated ODE parameter values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_df</span> <span class="o">=</span> <span class="n">dyn_act</span><span class="o">.</span><span class="n">track</span><span class="p">()</span>
<span class="n">track_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rt</th>
      <th>theta</th>
      <th>kappa</th>
      <th>rho</th>
      <th>sigma</th>
      <th>alpha1 [-]</th>
      <th>1/alpha2 [day]</th>
      <th>1/beta [day]</th>
      <th>1/gamma [day]</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2023-04-11</th>
      <td>0.78</td>
      <td>0.000048</td>
      <td>0.000002</td>
      <td>0.000651</td>
      <td>0.000833</td>
      <td>0.0</td>
      <td>6439</td>
      <td>16</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2023-04-12</th>
      <td>0.78</td>
      <td>0.000048</td>
      <td>0.000002</td>
      <td>0.000651</td>
      <td>0.000833</td>
      <td>0.0</td>
      <td>6439</td>
      <td>16</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2023-04-13</th>
      <td>0.78</td>
      <td>0.000048</td>
      <td>0.000002</td>
      <td>0.000651</td>
      <td>0.000833</td>
      <td>0.0</td>
      <td>6439</td>
      <td>16</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2023-04-14</th>
      <td>0.78</td>
      <td>0.000048</td>
      <td>0.000002</td>
      <td>0.000651</td>
      <td>0.000833</td>
      <td>0.0</td>
      <td>6439</td>
      <td>16</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2023-04-15</th>
      <td>0.78</td>
      <td>0.000048</td>
      <td>0.000002</td>
      <td>0.000651</td>
      <td>0.000833</td>
      <td>0.0</td>
      <td>6439</td>
      <td>16</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">track_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;Rt&#39;, &#39;theta&#39;, &#39;kappa&#39;, &#39;rho&#39;, &#39;sigma&#39;, &#39;alpha1 [-]&#39;, &#39;1/alpha2 [day]&#39;,
       &#39;1/beta [day]&#39;, &#39;1/gamma [day]&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the history of ODE parameter values tracked with global `track_df`.</span>

<span class="sd">    Args:</span>
<span class="sd">        param_name (str): name of the parameter</span>
<span class="sd">        title (str or None): figure title or Nome (@param_name will be used)</span>
<span class="sd">        h (list/tuple[int/float] or None): list of y values of horizontal lines or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">track_df</span>
    <span class="n">cs</span><span class="o">.</span><span class="n">line_plot</span><span class="p">(</span>
        <span class="n">track_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">param_name</span><span class="p">],</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Tracked </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="n">param_name</span><span class="p">,</span>
        <span class="n">math_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
        <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\theta\)</span> and <span class="math notranslate nohighlight">\(\alpha_1\)</span>:</div>
<div class="line">Enhancement of PCR tests suppressed the number of fatal cases before confirmation.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_101_0.png" src="_images/04_phase_dependent_101_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;alpha1 [-]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_102_0.png" src="_images/04_phase_dependent_102_0.png" />
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\kappa\)</span> and <span class="math notranslate nohighlight">\(1/\alpha_2\)</span>:</div>
<div class="line">Enhancement of medical system suppressed the number of fatal cases.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_104_0.png" src="_images/04_phase_dependent_104_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1/alpha2 [day]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_105_0.png" src="_images/04_phase_dependent_105_0.png" />
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(1/\beta\)</span>:</div>
<div class="line">Contact rate was changed with emergency declaration in Tokyo.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_107_0.png" src="_images/04_phase_dependent_107_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1/beta [day]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_108_0.png" src="_images/04_phase_dependent_108_0.png" />
</div>
</div>
<div class="line-block">
<div class="line"><span class="math notranslate nohighlight">\(\sigma\)</span> and <span class="math notranslate nohighlight">\(1/\gamma\)</span>:</div>
<div class="line">Recovery period is not changed clearly at this time.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_110_0.png" src="_images/04_phase_dependent_110_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1/gamma [day]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_111_0.png" src="_images/04_phase_dependent_111_0.png" />
</div>
</div>
<div class="line-block">
<div class="line">Reproduction number:</div>
<div class="line">Rt &gt; 1 means explosive outbreak.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;Rt&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tracked reproduction number&quot;</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/04_phase_dependent_113_0.png" src="_images/04_phase_dependent_113_0.png" />
</div>
</div>
<p>Thank you!</p>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"7b6ddd5cee8440cda46850f746d50213": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "30ec977c58ae4a5e966d6c8c433c24e9": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "c0437460ab354ce4a1040eff6e57659b": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_7b6ddd5cee8440cda46850f746d50213", "max": 6.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_30ec977c58ae4a5e966d6c8c433c24e9", "tabbable": null, "tooltip": null, "value": 6.0}}, "30e294b9e4e142dc9af3795ef1ee82b8": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "e1f7e4f99ada4e8590d37656c685fbeb": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "9a4ac7045456466fbe69df8fdb036487": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_30e294b9e4e142dc9af3795ef1ee82b8", "placeholder": "\u200b", "style": "IPY_MODEL_e1f7e4f99ada4e8590d37656c685fbeb", "tabbable": null, "tooltip": null, "value": "100%"}}, "eef8e603f97b49488730b5844b1a9b1b": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "bfde178cc0f542d9a643c2d29a67d4b0": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "5ae65fc3b90443ea92a2b5867f11b785": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_eef8e603f97b49488730b5844b1a9b1b", "placeholder": "\u200b", "style": "IPY_MODEL_bfde178cc0f542d9a643c2d29a67d4b0", "tabbable": null, "tooltip": null, "value": " 6/6 [00:29&lt;00:00,  4.35s/it]"}}, "5569315b254b4bdc93912f47489a997f": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "0404f603f327472f9541db8cb541ecc4": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_9a4ac7045456466fbe69df8fdb036487", "IPY_MODEL_c0437460ab354ce4a1040eff6e57659b", "IPY_MODEL_5ae65fc3b90443ea92a2b5867f11b785"], "layout": "IPY_MODEL_5569315b254b4bdc93912f47489a997f", "tabbable": null, "tooltip": null}}, "6af03d7f918a4078b68bf26ff7383ab0": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "41805a198e3541c7859107681fd97513": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "d6e41e5480f44e9898eb89443b81e6dd": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_6af03d7f918a4078b68bf26ff7383ab0", "max": 64.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_41805a198e3541c7859107681fd97513", "tabbable": null, "tooltip": null, "value": 64.0}}, "d7c66338aa07433c97d016fad156063a": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "3d5da509f25d4ec487f80fa4bceb3d23": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "37a0fe15ff9b41baabc5090673b917f2": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_d7c66338aa07433c97d016fad156063a", "placeholder": "\u200b", "style": "IPY_MODEL_3d5da509f25d4ec487f80fa4bceb3d23", "tabbable": null, "tooltip": null, "value": "100%"}}, "cdd3a5ea24b84ada84458c6335248278": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "fc2040b223f6472ea632379cfe5a75e9": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "eaecee0c0db84b0b9a877987100dae9f": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_cdd3a5ea24b84ada84458c6335248278", "placeholder": "\u200b", "style": "IPY_MODEL_fc2040b223f6472ea632379cfe5a75e9", "tabbable": null, "tooltip": null, "value": " 64/64 [03:58&lt;00:00,  1.89s/it]"}}, "8f51d97b6a6d45578fd5d480b8fa5da4": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "287de0b3bf654bcbae03be615d37934b": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_37a0fe15ff9b41baabc5090673b917f2", "IPY_MODEL_d6e41e5480f44e9898eb89443b81e6dd", "IPY_MODEL_eaecee0c0db84b0b9a877987100dae9f"], "layout": "IPY_MODEL_8f51d97b6a6d45578fd5d480b8fa5da4", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="03_ode.html" class="btn btn-neutral float-left" title="SIR-derived ODE models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="05_scenario_analysis.html" class="btn btn-neutral float-right" title="Scenario analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Hirokazu Takaya and CovsirPhy Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>